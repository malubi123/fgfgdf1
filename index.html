<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>GIF z napisów</title>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>
<style>
body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
input, button { margin: 5px 0; padding: 5px; }
img { margin-top: 20px; border: 1px solid #ccc; }
</style>
</head>
<body>

<h1>Generator GIF z napisów</h1>

<label>Plik SRT: <input type="file" id="srtFile" accept=".srt"></label><br>
<label>Czcionka: <input type="text" id="font" value="Arial"></label><br>
<label>Rozmiar czcionki: <input type="number" id="fontSize" value="32"></label><br>
<label>Kolor czcionki: <input type="color" id="color" value="#000000"></label><br>
<label>Tło: <input type="color" id="bgColor" value="#ffffff"></label><br>
<button id="generate">Generuj GIF</button>

<img id="result" alt="Twój GIF pojawi się tutaj">

<script>
document.getElementById('generate').addEventListener('click', () => {
    const fileInput = document.getElementById('srtFile');
    if (!fileInput.files[0]) return alert('Wybierz plik SRT!');
    
    const font = document.getElementById('font').value;
    const fontSize = parseInt(document.getElementById('fontSize').value);
    const color = document.getElementById('color').value;
    const bgColor = document.getElementById('bgColor').value;

    const reader = new FileReader();
    reader.onload = e => {
        const subtitles = parseSRT(e.target.result);
        createGIF(subtitles, font, fontSize, color, bgColor);
    };
    reader.readAsText(fileInput.files[0]);
});

function parseSRT(data) {
    const regex = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\n|\n*$)/g;
    const subtitles = [];
    let match;
    while ((match = regex.exec(data)) !== null) {
        subtitles.push({
            start: timeToMs(match[2]),
            end: timeToMs(match[3]),
            text: match[4].replace(/\r/g,'').replace(/\n/g,' ')
        });
    }
    return subtitles;
}

function timeToMs(time) {
    const [h,m,sms] = time.split(':');
    const [s, ms] = sms.split(',');
    return parseInt(h)*3600000 + parseInt(m)*60000 + parseInt(s)*1000 + parseInt(ms);
}

function createGIF(subtitles, font, fontSize, color, bgColor) {
    const gif = new GIF({ workers: 1, quality: 10 }); // main-thread

    subtitles.forEach(sub => {
        const canvas = document.createElement('canvas');
        canvas.width = 500;
        canvas.height = 100;
        const ctx = canvas.getContext('2d');

        ctx.fillStyle = bgColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = color;
        ctx.font = fontSize + 'px ' + font;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(sub.text, canvas.width/2, canvas.height/2);

        gif.addFrame(canvas, { delay: Math.max(sub.end - sub.start, 200) });
    });

    gif.on('finished', function(blob) {
        document.getElementById('result').src = URL.createObjectURL(blob);
    });

    gif.render();
}
</script>

</body>
</html>
